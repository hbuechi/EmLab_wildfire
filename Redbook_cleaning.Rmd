---
title: "Cleaning Redbook data"
author: "Hanna Buechi"
date: "8/6/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

See Google document for notes and more details: https://docs.google.com/document/d/1FLUtA51ho4nW5CKgt4DMQCBJFIL3fUAzCFjL5bojCOE/edit

###Plan:

1) Standardize column names by hand via in Google Drive: https://drive.google.com/open?id=1uph0UONuYxq34WErMYA9C2FJ8zHDI1FT1ltEbFn2VBY
2) Upload CSV for each year to github folder: EmLab_wildfire
3) Wrangle stuff
4) Write for loop to add new columns (https://stackoverflow.com/questions/45857787/adding-column-if-it-does-not-exist)
5) Bind all CSV's together into a single dataframe (https://stackoverflow.com/questions/2851327/convert-a-list-of-data-frames-into-one-data-frame)

##Wrangling my single dataframe with all of the years:

1) Change "Cal Fire" to "CDF" with recode()
2) Standardize Veg_type
3) Standardize Cause
      Tabulate "Cause" possibilities --> little table function (ESM 244 HW on my laptop) OR count(dataframe, "column heading")

```{r data_packages, message=FALSE}

library(tidyverse)
library(tibble)
library(plyr) # for rbind.fill()
library(readr)
library(lubridate)

rb1979 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1979.csv")
rb1980 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1980.csv")
rb1981 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1981.csv")
rb1982 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1982.csv")
rb1983 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1983.csv")
rb1984 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1984.csv")
rb1985 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1985.csv")
rb1986 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1986.csv")
rb1987 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1987.csv")
rb1988 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1988.csv")
rb1989 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1989.csv")
rb1990 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1990.csv")
rb1991 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1991.csv")
rb1992 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1992.csv")
rb1993 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1993.csv")
rb1994 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1994.csv")
rb1995 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1995.csv")
rb1996 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1996.csv")
rb1997 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1997.csv")
rb1998 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1998.csv")
rb1999 <- read_csv("CDF_fire_damage_1984-2017_V2 - 1999.csv")
rb2000 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2000.csv")
rb2001 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2001.csv")
rb2002 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2002.csv")
rb2003 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2003.csv")
rb2004 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2004.csv")
rb2005 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2005.csv")
rb2006 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2006.csv")
rb2007 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2007.csv")
rb2008a <- read_csv("CDF_fire_damage_1984-2017_V2 - 2008.csv")
rb2008b <- read_csv("CDF_fire_damage_1984-2017_V2 - 2008 non-CDF.csv")
rb2009a <- read_csv("CDF_fire_damage_1984-2017_V2 - 2009.csv")
rb2009b <- read_csv("CDF_fire_damage_1984-2017_V2 - 2009 non-CDF.csv")
rb2010 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2010.csv")
rb2011 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2011.csv")
rb2012 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2012.csv")
rb2013 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2013.csv")
rb2014 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2014.csv")
rb2015 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2015.csv")
rb2016 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2016.csv")
rb2017 <- read_csv("CDF_fire_damage_1984-2017_V2 - 2017.csv")

```

###Add columns where needed
```{r add_column_loop}

# I need to add columns to most, if not all, of the Cal Fire dataframes so that they can be bound together into a single dataframe. Thanks, Stack Overflow, for the code!

list <- list(redbook_1979, redbook_1980, redbook_1981, redbook_1982, redbook_1983, redbook_1984, redbook_1985, redbook_1986, redbook_1987, redbook_1988, redbook_1989, redbook_1990, redbook_1991, redbook_1992, redbook_1993, redbook_1994, redbook_1995, redbook_1996, redbook_1997, redbook_1998, redbook_1999, redbook_2000, redbook_2001, redbook_2002, redbook_2003, redbook_2004, redbook_2005, redbook_2006, redbook_2007, redbook_2008a, redbook_2008b, redbook_2009a, redbook_2009b, redbook_2010, redbook_2011, redbook_2012, redbook_2013, redbook_2014, redbook_2015, redbook_2016, redbook_2017) # list of dfs for the forloop

cols <- c(Incident_number = NA_real_, Region = NA_real_, Ranger_unit = NA_real_, Ranger_unit2 = NA_real_, National_forest = NA_character_, County = NA_real_, County2 = NA_real_, County3 = NA_real_, Fire_name2 = NA_real_, DPA = NA_real_, DPA2 = NA_real_, CDF_acres_burned = NA_real_, Other_acres_burned = NA_real_, Veg_type = NA_real_, Cause = NA_real_, Destroyed_structures = NA_integer_, Damaged_structures = NA_integer_, Firefighter_fatalities = NA_real_, Civilian_fatalities = NA_real_, Start = NA_real_, Contained = NA_real_) 
# vector of column headings to be populated with NAs if they are being added

for (i in 1:length(list)){
 list[[i]] <- add_column(list[[i]], !!!cols[!names(cols) %in% names(list[[i]])])
} # looped-de-loop!

calfire_data <- rbind.fill(list) # binds the list of dataframes together

```

###Wrangle stuff
```{r check_classes_of_columns}

#lapply(calfire_data, class) # check the class of each column in the dataframe and change as needed
# belows are the changes that needed to be made

calfire_data$Cause <- as.character(calfire_data$Cause)
calfire_data$CDF_acres_burned <- as.numeric(calfire_data$CDF_acres_burned)
calfire_data$Other_acres_burned <- as.numeric(calfire_data$Other_acres_burned)
calfire_data$Destroyed_structures <- as.numeric(calfire_data$Destroyed_structures)
calfire_data$Damaged_structures <- as.numeric(calfire_data$Damaged_structures) 
calfire_data$Firefighter_fatalities <- as.numeric(calfire_data$Firefighter_fatalities)
calfire_data$Civilian_fatalities <- as.numeric(calfire_data$Civilian_fatalities)
#calfire_data$Start <- as.Date(calfire_data$Start)
#calfire_data$Contained <- as.Date(calfire_data$Contained)

# damaged, firefighter, and civilian have N/As
# damaged has "Yes" for Devils 1994, 100's for Wheel 1993

```

###Standardize vegetation type, cause
```{r standardize_veg_CDF}

# check out all of the values for Veg_type and DPA, standardize as needed. I'm sure this could be made into shorter code, but I didn't now how. See Google Drive for the veg type codes: https://drive.google.com/open?id=1XVDiNHeqq2jxiQqYmb657MMfjK9UIYU6PorzYV_QubY

#unique(calfire_data$Veg_type) # shows me all of the possibilities so that I can copy and paste...
#unique(calfire_data$DPA2)

calfire_data <- calfire_data %>% 
  mutate(DPA=recode(DPA, "Cal Fire"="CDF", "CalFire"="CDF")) %>% 
  mutate(Veg_type=recode(Veg_type, "CONIFERS"="C")) %>%
  mutate(Veg_type=recode(Veg_type, "G/AGPROD"="GA")) %>%
  mutate(Veg_type=recode(Veg_type, "Timber"="T")) %>%
  mutate(Veg_type=recode(Veg_type, "Brush"="B")) %>%
  mutate(Veg_type=recode(Veg_type, "Grass, Brush"="GB")) %>%
  mutate(Veg_type=recode(Veg_type, "Brush, Grass"="BG")) %>%
  mutate(Veg_type=recode(Veg_type, "Woodland"="W")) %>%
  mutate(Veg_type=recode(Veg_type, "Brush, Grass, Timber"="BGT")) %>%
  mutate(Veg_type=recode(Veg_type, "Grass"="G")) %>%
  mutate(Veg_type=recode(Veg_type, "Timber, Grass"="TG")) %>%
  mutate(Veg_type=recode(Veg_type, "Timber, Brush, Grass"="TBG")) %>%
  mutate(Veg_type=recode(Veg_type, "Unknown"="U")) %>%
  mutate(Veg_type=recode(Veg_type, "Timber, Woodland"="TW")) %>%
  mutate(Veg_type=recode(Veg_type, "Timber, Brush"="TB")) %>%
  mutate(Veg_type=recode(Veg_type, "Brush, Timber"="BT")) %>%
  mutate(Veg_type=recode(Veg_type, "Timer, Brush"="TB")) %>% 
  mutate(Veg_type=recode(Veg_type, "BGAP"="BGA")) %>%
  mutate(Veg_type=recode(Veg_type, "WBGAP"="WBGA")) %>%
  mutate(Veg_type=recode(Veg_type, "WAP"="WA")) %>%
  mutate(Veg_type=recode(Veg_type, "TWAP"="TWA")) %>%
  mutate(Veg_type=recode(Veg_type, "BAP"="BA")) %>%
  mutate(Veg_type=recode(Veg_type, "TGWAPB"="TGWAB")) %>%
  mutate(Veg_type=recode(Veg_type, "GAPB"="GAB"))

```

```{r standardize_cause}

# same notes as above, but there are some causes that I haven't standardized yet. See list at the bottom of this chunk...

#unique(calfire_data$Cause)

calfire_data <- calfire_data %>% 
  mutate(Cause=recode(Cause, "Equip. Use"="Equipment use")) %>% 
  mutate(Cause=recode(Cause, "N/A"="NA")) %>%   
  mutate(Cause=recode(Cause, "Cmpr."="Campfire")) %>%
  mutate(Cause=recode(Cause, "Smkr."="Smoking")) %>% 
  mutate(Cause=recode(Cause, "Misc."="Misc")) %>% 
  mutate(Cause=recode(Cause, "Elec. Power"="Electrical power")) %>% 
  mutate(Cause=recode(Cause, "P/W/F"="Playing with fire")) %>% 
  mutate(Cause=recode(Cause, "Ltng."="Lightning")) %>% 
  mutate(Cause=recode(Cause, "Smkg."="Smoking")) %>% 
  mutate(Cause=recode(Cause, "Play./W/Fire"="Playing with fire")) %>% 
  mutate(Cause=recode(Cause, "Playing/W Fire"="Playing with fire")) %>% 
  mutate(Cause=recode(Cause, "Miscellaneous"="Misc")) %>% 
  mutate(Cause=recode(Cause, "Equip."="Equipment use")) %>% 
  mutate(Cause=recode(Cause, "Play w/fire"="Playing with fire")) %>% 
  mutate(Cause=recode(Cause, "Power"="Electrical power")) %>%
  mutate(Cause=recode(Cause, "Undet."="Undetermined")) %>%
  mutate(Cause=recode(Cause, "Smoker"="Smoking")) %>%
  mutate(Cause=recode(Cause, "Play/W/Fire"="Playing with fire")) %>%
  mutate(Cause=recode(Cause, "Arcing Pwerline"="Powerlines")) %>%
  mutate(Cause=recode(Cause, "Powerline"="Powerlines")) %>%
  mutate(Cause=recode(Cause, "Electrical Pwr"="Electrical power")) %>%
  mutate(Cause=recode(Cause, "Exposure Fire"="Exposure")) %>%
  mutate(Cause=recode(Cause, "Equipment"="Equipment use")) %>%
  mutate(Cause=recode(Cause, "Elec. Pow."="Electrical power")) %>%
  mutate(Cause=recode(Cause, "Munition"="Shooting")) %>%
  mutate(Cause=recode(Cause, "PWF"="Playing with fire")) %>%
  mutate(Cause=recode(Cause, "Elect. Power"="Electrical power")) %>%
  mutate(Cause=recode(Cause, "Under Inv."="Under investigation")) %>%
  mutate(Cause=recode(Cause, "Lawn Mower"="Equipment use")) %>%
  mutate(Cause=recode(Cause, "Under Invest."="Under investigation")) %>%
  mutate(Cause=recode(Cause, "Shooter"="Shooting")) %>%
  mutate(Cause=recode(Cause, "Welding"="Equipment use")) %>%
  mutate(Cause=recode(Cause, "P-W-F"="Playing with fire")) %>%
  mutate(Cause=recode(Cause, "Inidentified"="Unidentified")) %>%
  mutate(Cause=recode(Cause, "Miscellaneous Human"="Misc")) %>%
  mutate(Cause=recode(Cause, "Other Cause"="Other")) %>%
  mutate(Cause=recode(Cause, "Electrical"="Electrical power")) %>%
  mutate(Cause=recode(Cause, "UI"="Unidentified")) %>%
  mutate(Cause=recode(Cause, "LIghtning"="Lightning")) %>%
  mutate(Cause=recode(Cause, "Electrical Power"="Electrical power")) %>%
  mutate(Cause=recode(Cause, "Playing with Fire"="Playing with fire"))

# Rekindle debris? Equip. RR? Exposure? VMP Burn? UL? Rekindle? Control Burn? Hostile Fire? Escape Control? Debris Burning? Human? Structure? Debris, veg burn? Incediary? Open Outdoors? Miscellaneous Human? Misuse of Fire?

```











